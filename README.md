# Nepgear

**Nepgear** æ˜¯ä¸€ä¸ªä¸“ä¸ºæ—¥è¯­ Galgameï¼ˆè§†è§‰å°è¯´ï¼‰è®¾è®¡çš„é€šç”¨ DLL åŠ«æŒä¸ Hook æ¡†æ¶ã€‚

é€šè¿‡åŠ«æŒç³»ç»Ÿ DLLï¼ˆé»˜è®¤ `winmm.dll`ï¼‰ï¼ŒNepgear å¯ä»¥è‡ªåŠ¨éšæ¸¸æˆå¯åŠ¨ï¼Œå¹¶æä¾›åŒºåŸŸæ¨¡æ‹Ÿã€å­—ä½“æ›¿æ¢ã€æ–‡ä»¶é‡å®šå‘ç­‰å¼ºå¤§åŠŸèƒ½ã€‚

## âœ¨ ä¸»è¦åŠŸèƒ½

*   **DLL åŠ«æŒåŠ è½½**ï¼šåˆ©ç”¨ `winmm.dll` ä»£ç†æŠ€æœ¯ï¼Œæ— éœ€ä¿®æ”¹æ¸¸æˆåŸæœ‰å¯æ‰§è¡Œæ–‡ä»¶å³å¯è‡ªåŠ¨åŠ è½½ã€‚
*   **åŒºåŸŸæ¨¡æ‹Ÿ (Locale Emulator)**ï¼š
    *   å†…ç½®åŒºåŸŸæ¨¡æ‹ŸåŠŸèƒ½ï¼Œå¯åœ¨éæ—¥è¯­ç³»ç»Ÿä¸Šç›´æ¥è¿è¡Œ Shift-JIS ç¼–ç çš„æ—¥è¯­æ¸¸æˆã€‚
    *   æ”¯æŒæ¨¡æ‹Ÿ Shift-JIS (932) æˆ– GBK (936) ç¯å¢ƒã€‚
*   **é«˜çº§å­—ä½“æŒ‚é’© (Font Hook)**ï¼š
    *   åŠ¨æ€æ›¿æ¢æ¸¸æˆå­—ä½“ï¼ˆé»˜è®¤ `galgame_cnjp.ttf`ï¼‰ã€‚
    *   æ”¯æŒè‡ªå®šä¹‰å­—ä½“å¤§å°ç¼©æ”¾ï¼ˆå®½é«˜æ¯”è°ƒæ•´ï¼‰ã€‚
    *   æ”¯æŒå­—ä½“ç²—ç»†è°ƒæ•´ã€‚
    *   å¼ºåˆ¶æŒ‡å®šå­—ç¬¦é›†ï¼ˆè§£å†³ä¹±ç é—®é¢˜ï¼‰ã€‚
*   **çª—å£æ ‡é¢˜ä¿®æ”¹**ï¼šè‡ªå®šä¹‰æ¸¸æˆçª—å£æ ‡é¢˜ï¼Œæ”¯æŒ Unicodeã€‚
*   **è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿ (VFS) & æ–‡ä»¶é‡å®šå‘**ï¼š
    *   å°†æ¸¸æˆè¯»å–çš„æ–‡ä»¶é‡å®šå‘åˆ°å¤–éƒ¨æ–‡ä»¶å¤¹ï¼ˆå¦‚ `Nepgear/`ï¼‰ã€‚
    *   æ”¯æŒè¯»å–æ‰“åŒ…çš„ `.chs` èµ„æºåŒ…ï¼ˆç±»ä¼¼å°åŒ…æ±‰åŒ–ï¼‰ã€‚
    *   ä¼˜å…ˆè¯»å–å¤–éƒ¨æ–‡ä»¶ï¼Œæ–¹ä¾¿æ›¿æ¢æ¸¸æˆèµ„æºï¼ˆå›¾ç‰‡ã€è„šæœ¬ç­‰ï¼‰ã€‚

## ğŸ› ï¸ æ„å»ºæŒ‡å—

### ç¯å¢ƒè¦æ±‚
*   Visual Studio 2022 (v143 å·¥å…·é›†)
*   Windows SDK

### ç¼–è¯‘æ­¥éª¤
1.  ä½¿ç”¨ Visual Studio 2022 æ‰“å¼€ `Nepgear.sln`ã€‚
2.  é€‰æ‹©æ„å»ºé…ç½®ä¸º `Release` / `x86` (å¤§å¤šæ•° Galgame ä¸º 32 ä½ç¨‹åº)ã€‚
3.  ç‚¹å‡» **ç”Ÿæˆè§£å†³æ–¹æ¡ˆ (Build Solution)**ã€‚
4.  ç¼–è¯‘å®Œæˆåï¼š
    *   åœ¨ `Release/` ç›®å½•ä¸‹ä¼šç”Ÿæˆ `Nepgear.dll`ã€‚
    *   åœ¨ `Packer/Release/` (æˆ–ç±»ä¼¼è·¯å¾„) ä¸‹ä¼šç”Ÿæˆ `Packer.exe`ã€‚

## ğŸ“¦ å®‰è£…ä¸ä½¿ç”¨

### 1. éƒ¨ç½²æ–‡ä»¶
å°†ä»¥ä¸‹æ–‡ä»¶å¤åˆ¶åˆ°æ¸¸æˆæ ¹ç›®å½•ï¼ˆå³æ¸¸æˆä¸» EXE æ‰€åœ¨çš„ç›®å½•ï¼‰ï¼š

1.  **Nepgear.dll** -> é‡å‘½åä¸º **`winmm.dll`**ã€‚
    *   *åŸç†ï¼šæ¸¸æˆå¯åŠ¨æ—¶ä¼šå°è¯•åŠ è½½ç³»ç»Ÿçš„ winmm.dllï¼Œé‡å‘½ååæ¸¸æˆä¼šä¼˜å…ˆåŠ è½½æˆ‘ä»¬çš„ DLLï¼ŒNepgear ä¼šè‡ªåŠ¨å°†åŸæœ‰å‡½æ•°è°ƒç”¨è½¬å‘ç»™ç³»ç»ŸçœŸæ­£çš„ winmm.dllã€‚*
2.  **Nepgear.ini** -> é…ç½®æ–‡ä»¶ã€‚
3.  **galgame_cnjp.ttf** -> ä½ æƒ³è¦æ›¿æ¢çš„å­—ä½“æ–‡ä»¶ï¼ˆæ–‡ä»¶åéœ€ä¸ ini ä¸­é…ç½®ä¸€è‡´ï¼‰ã€‚

### 2. é…ç½®æ–‡ä»¶è¯´æ˜ (Nepgear.ini)
é…ç½®æ–‡ä»¶éœ€ä¿å­˜ä¸º **UTF-16 LE** ç¼–ç ã€‚

```ini
[System]
Enable=1                ; å¯ç”¨/ç¦ç”¨æ’ä»¶

[Font]
Enable=1                ; å¯ç”¨å­—ä½“ Hook
FileName=galgame_cnjp.ttf ; å­—ä½“æ–‡ä»¶å (éœ€æ”¾åœ¨æ¸¸æˆç›®å½•)
FaceName=galgame        ; å­—ä½“åç§° (é€šå¸¸ä¸éœ€è¦ä¿®æ”¹ï¼Œé™¤éæ¸¸æˆæ£€æŸ¥å­—ä½“å)

; å­—ç¬¦é›†å¼ºåˆ¶æ›¿æ¢ (128=Shift-JIS, 134=GB2312)
Charset=128
EnableCharsetReplace=1

; å­—ä½“å®½é«˜ç¼©æ”¾ (1.0 ä¸ºåŸå§‹æ¯”ä¾‹)
EnableHeightScale=1
HeightScale=1.0
EnableWidthScale=1
WidthScale=1.0

; å­—ä½“ç²—ç»† (0=é»˜è®¤, 400=æ­£å¸¸, 700=ç²—ä½“)
EnableWeight=1
Weight=0

[Window]
Enable=1                ; å¯ç”¨çª—å£æ ‡é¢˜ä¿®æ”¹
Title=è‡ªå®šä¹‰æ¸¸æˆæ ‡é¢˜     ; æ–°çš„çª—å£æ ‡é¢˜

[FileRedirect]
Enable=1                ; å¯ç”¨æ–‡ä»¶é‡å®šå‘
Folder=Nepgear          ; é‡å®šå‘è¯»å–çš„æ–‡ä»¶å¤¹åç§°
ArchiveFile=Nepgear.chs ; æ‰“åŒ…èµ„æºæ–‡ä»¶å (ä¼˜å…ˆçº§ä½äºæ–‡ä»¶å¤¹)

[LocaleEmulator]
Enable=1                ; å¯ç”¨åŒºåŸŸæ¨¡æ‹Ÿ
CodePage=932            ; æ¨¡æ‹Ÿä»£ç é¡µ (932=æ—¥è¯­, 936=ä¸­æ–‡)
LocaleID=1041           ; åŒºåŸŸ ID (1041=æ—¥è¯­, 2052=ä¸­æ–‡)
Charset=128             ; é»˜è®¤å­—ç¬¦é›†
Timezone=Tokyo Standard Time ; æ¨¡æ‹Ÿæ—¶åŒº
```

### 3. ä½¿ç”¨ Packer æ‰“åŒ…èµ„æº
Nepgear é…å¥—äº†ä¸€ä¸ªç®€å•çš„æ‰“åŒ…å·¥å…· `Packer.exe`ï¼Œç”¨äºå°†ç¿»è¯‘èµ„æºæ‰“åŒ…æˆ `.chs` å•ä¸ªæ–‡ä»¶ã€‚

**ä½¿ç”¨æ–¹æ³•ï¼š**
1.  å°†éœ€è¦æ›¿æ¢çš„æ¸¸æˆèµ„æºï¼ˆå›¾ç‰‡ã€è„šæœ¬ç­‰ï¼‰æ”¾å…¥ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œä¿æŒåŸæœ‰çš„ç›®å½•ç»“æ„ã€‚
2.  å°†è¯¥æ–‡ä»¶å¤¹ç›´æ¥**æ‹–æ‹½**åˆ° `Packer.exe` å›¾æ ‡ä¸Šã€‚
3.  ç¨‹åºä¼šè‡ªåŠ¨åœ¨åŒçº§ç›®å½•ç”ŸæˆåŒåçš„ `.chs` æ–‡ä»¶ï¼ˆä¾‹å¦‚æ‹–æ‹½ `Nepgear` æ–‡ä»¶å¤¹ -> ç”Ÿæˆ `Nepgear.chs`ï¼‰ã€‚
4.  å°†ç”Ÿæˆçš„ `.chs` æ–‡ä»¶æ”¾å…¥æ¸¸æˆç›®å½•ï¼Œå¹¶åœ¨ `Nepgear.ini` ä¸­é…ç½® `ArchiveFile=xxx.chs`ã€‚
